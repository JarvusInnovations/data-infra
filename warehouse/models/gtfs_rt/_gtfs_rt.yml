version: 2

sources:
  - name: gtfs_rt_raw
    database: cal-itp-data-infra
    schema: gtfs_rt
    tables:
      - name: calitp_files


models:
  - name: gtfs_rt_fact_files
    description: |
      Each row is a GTFS realtime file that was downloaded.
      Note that presence of a file is not a guarantee that the downloaded file is complete or valid.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - calitp_extracted_at
            - calitp_itp_id
            - calitp_url_number
            - name
    columns:
      - name: calitp_extracted_at
        description: Timestamp when this file was extracted
        tests:
          - not_null
      - name: calitp_itp_id
        description: '{{ doc("field_calitp_itp_id") }}'
        tests:
          - not_null
      - name: calitp_url_number
        description: '{{ doc("field_calitp_url_number") }}'
        tests:
          - not_null
      - name: name
        description: File type (service_alerts, trip_updates, or vehicle_positions)
        tests:
          - not_null
      - name: size
        description: File size in bytes
        tests:
          - not_null
      - name: md5_hash
        description: Hash of file contents
        tests:
          - not_null
      - name: date_extracted
        description: Date extracted from calitp_extracted_at
        tests:
          - not_null
      - name: hour_extracted
        description: Hour extracted from calitp_extracted_at
        tests:
          - not_null
      - name: minute_extracted
        description: Minute extracted from calitp_extracted_at
        tests:
          - not_null
